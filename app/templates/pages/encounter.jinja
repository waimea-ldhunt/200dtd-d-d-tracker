{#=====================================================
  Thing page
  - Shows details of a single thing
  - Has a delete link to remove it
=====================================================#}

{% extends 'pages/base.jinja' %}


{% block title %}

    {{ encounter.name }}

{% endblock %}


{% block content %}
    <header>
        <article id="encounter">
            <h2>{{ encounter.name }}</h2>
            <p>{{ encounter.description }}</p>
        </article>
    </header>

    {% if active %}
        <hr class="line"/>
        <article id="initiative">
            <h3>Initiative</h3>

            {% for character in characters %}
                {% if character.active == 1 %}
                    <article class="item">

                        <article class="character">
                            {% if character.roll %}
                                <div class="roll">
                                    <h3>{{character.roll}}</h3>
                                </div>
                            {% else %}
                                <a role="button" class="secondary" id="roll_button" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/roll"><p>Roll</p></a>
                            {% endif %}
                            
                            <div class="name">
                                <h4>{{character.name}}</h4>
                            </div>

                            <div class="health">
                                <img class="heart" src="/static/images/heart.svg">
                                <p><strong>{{character.hp}}</strong>/{{character.max_hp}}</p>
                            </div>

                            <a onclick="dropdown({{character.init_id}})"><img src="/static/images/arrow.svg" id="arrow_{{character.init_id}}" class="arrow_down"></a>
                        </article>

                        <section id="dropdown_{{character.init_id}}" class="dropdown_closed">
                            
                            <hr/>

                            <form method="POST" action="/encounter/{{encounter.id}}/character/{{character.id}}/update">


                                <section class="row">
                                    <h4 id="name">{{character.name}}</h4>

                                    {% if character.type == "P" %}
                                        <h6><u id="type">Player</u></h6>
                                    {% elif character.type == "E" %}
                                        <h6><u id="type">Enemy</u></h6>
                                    {% elif character.type == "B" %}
                                        <h6><u id="type">Boss</u></h6>
                                    {% elif character.type == "N" %}
                                        <h6><u id="type">NPC</u></h6>
                                    {% endif %}

                                    <h6 id="space">|</h6>

                                    <h6>Health:</h6>

                                    <input name="hp" type="number" value="{{character.hp}}" class="character_input">

                                    <h1>/</h1>

                                    <input name="max_hp" type="number" value="{{character.max_hp}}" class="character_input">
                                </section>

                                <section class="row">
                                    <fieldset>
                                        <h6>AC</h6>
                                        <input name="ac" type="number" value="{{character.ac}}" class="character_input">
                                    </fieldset>

                                    <fieldset>
                                        <h6>Initiative Bonus</h6>
                                        <input name="initiative_bonus" type="number" value="{{character.initiative_bonus}}" class="character_input">
                                    </fieldset>
                                </section>

                                <h6>Notes</h6>
                                <textarea name="notes" placeholder="Notes" id="character_input">{{character.notes}}</textarea>

                                <div role="group">
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/deactivate">Deactivate</a>
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/roll">Roll Initiative</a>
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.id}}/extra_turn">Add Extra Turn</a>
                                    <a role="button" class="secondary" onclick="return confirm('Are you sure you wish to delete this turn?')" href="/encounter/{{encounter.id}}/character/{{character.id}}/turn/{{character.init_id}}/remove_turn">Remove Turn</a>
                                    <a role="button" class="secondary" onclick="return confirm('Are you sure you wish to delete {{character.name}}?')" href="/encounter/{{encounter.id}}/character/{{character.id}}/delete">Delete Character</a>
                                </div>

                                <input class="submit" type="submit" value="Save Changes">
                            </form>

                        </section>

                    </article>
                {% endif %}

            {% endfor %}

        </article>
    {% endif %}
    
    {% if inactive %}
        <hr class="line"/>
        <article id="inactive">
            <h3>Inactive Characters</h3>

            {% for character in characters %}
                {% if character.active == 0 %}
                    <article class="item">

                        <article class="character">

                            <a role="button" class="activate" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/activate">Activate</a>
                            
                            <div class="name">
                                <h4>{{character.name}}</h4>
                            </div>

                            <div class="health">
                                <img class="heart" src="/static/images/heart.svg">
                                <p><strong>{{character.hp}}</strong>/{{character.max_hp}}</p>
                            </div>

                            <a onclick="dropdown({{character.init_id}})"><img src="/static/images/arrow.svg" id="arrow_{{character.init_id}}" class="arrow_down"></a>
                        </article>

                        <section id="dropdown_{{character.init_id}}" class="dropdown_closed">
                            
                            <hr/>

                            <form method="POST" action="/encounter/{{encounter.id}}/character/{{character.id}}/update">


                                <section class="row">
                                    <h4 id="name">{{character.name}}</h4>

                                    {% if character.type == "P" %}
                                        <h6><u id="type">Player</u></h6>
                                    {% elif character.type == "E" %}
                                        <h6><u id="type">Enemy</u></h6>
                                    {% elif character.type == "B" %}
                                        <h6><u id="type">Boss</u></h6>
                                    {% elif character.type == "N" %}
                                        <h6><u id="type">NPC</u></h6>
                                    {% endif %}

                                    <h6 id="space">|</h6>

                                    <h6>Health:</h6>

                                    <input name="hp" type="number" value="{{character.hp}}" class="character_input">

                                    <h1>/</h1>

                                    <input name="max_hp" type="number" value="{{character.max_hp}}" class="character_input">
                                </section>

                                <section class="row">
                                    <fieldset>
                                        <h6>AC</h6>
                                        <input name="ac" type="number" value="{{character.ac}}" class="character_input">
                                    </fieldset>

                                    <fieldset>
                                        <h6>Initiative Bonus</h6>
                                        <input name="initiative_bonus" type="number" value="{{character.initiative_bonus}}" class="character_input">
                                    </fieldset>
                                </section>

                                <h6>Notes</h6>
                                <textarea name="notes" placeholder="Notes" id="character_input">{{character.notes}}</textarea>

                                <div role="group">
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/activate">Activate</a>
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.init_id}}/roll">Roll Initiative</a>
                                    <a role="button" class="secondary" href="/encounter/{{encounter.id}}/character/{{character.id}}/extra_turn">Add Extra Turn</a>
                                    <a role="button" class="secondary" onclick="return confirm('Are you sure you wish to delete this turn?')" href="/encounter/{{encounter.id}}/character/{{character.id}}/turn/{{character.init_id}}/remove_turn">Remove Turn</a>
                                    <a role="button" class="secondary" onclick="return confirm('Are you sure you wish to delete {{character.name}}?')" href="/encounter/{{encounter.id}}/character/{{character.id}}/delete">Delete Character</a>
                                </div>

                                <input class="submit" type="submit" value="Save Changes">
                            </form>

                        </section>

                    </article>
                {% endif %}
            {% endfor %}

        </article>
    {% endif %}
    <hr class="line"/>
    <article id="character_form">
        <h3>Add a character</h3>
        <form method="POST" action="/encounter/{{encounter.id}}/add" >

            <fieldset role="group">
                <input name="name" placeholder="Name" required  class="character_input">

                <select name="type" required id="character_input">
                    <option selected disabled hidden>Character Type</option>
                    <option>Player</option>
                    <option>Enemy</option>
                    <option>NPC</option>
                    <option>Boss</option>
                    <option>Other</option>
                </select>
            </fieldset>
            
            <div class="grid">
                <input name="ac" placeholder="Armor Class" type="number" class="character_input">
                <input name="max_hp" placeholder="Max Hitpoints" type="number" required class="character_input">
                <input name="initiative" placeholder="Initiative Bonus" type="number" class="character_input">
            </div>

            <textarea name="notes" placeholder="Notes" rows="5" cols="40" style="overflow: auto;" id="character_input"></textarea>
            <input class="submit" type="submit" value="Add Character to Encounter">
        </form>
    </article>

{% endblock %}